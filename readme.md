# graphql-api-koa

[![npm version](https://img.shields.io/npm/v/graphql-api-koa.svg)](https://npm.im/graphql-api-koa) ![Licence](https://img.shields.io/npm/l/graphql-api-koa.svg) [![Github issues](https://img.shields.io/github/issues/jaydenseric/graphql-api-koa.svg)](https://github.com/jaydenseric/graphql-api-koa/issues) [![Github stars](https://img.shields.io/github/stars/jaydenseric/graphql-api-koa.svg)](https://github.com/jaydenseric/graphql-api-koa/stargazers) [![Travis status](https://img.shields.io/travis/jaydenseric/graphql-api-koa.svg)](https://travis-ci.org/jaydenseric/graphql-api-koa)

GraphQL API Koa middleware.

## Setup

Install with [npm](https://npmjs.com):

```sh
npm install graphql-api-koa
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

- [graphqlApi](#graphqlapi)
- [errorHandler](#errorhandler)
- [bodyParser](#bodyparser)
- [execute](#execute)
- [Types](#types)
  - [ExecuteOptions](#executeoptions)
  - [MiddlewareOptionsOverride](#middlewareoptionsoverride)

### graphqlApi

Composes Koa middleware for a basic GraphQL API. Includes [errorHandler](#errorhandler), [bodyParser](#bodyparser) and [execute](#execute).

**Parameters**

- `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Options. (optional, default `{}`)
  - `options.execute` **[ExecuteOptions](#executeoptions)** Execute middleware options.

**Examples**

_A basic GraphQL API._

```javascript
import Koa from 'koa'
import { graphqlApi } from 'graphql-api-koa'
import schema from './schema'

const app = new Koa().use(
  graphqlApi({
    execute: {
      schema
    }
  })
)
```

Returns **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** Koa middleware.

### errorHandler

- **See: [GraphQL Draft RFC Specification October 2016 ยง 7.2.2](http://facebook.github.io/graphql/October2016/#sec-Errors).**
- **See: [http-errors on npm](https://npm.im/http-errors).**

Creates Koa middleware to handle errors. Included in [graphqlApi](#graphqlapi) first to catch all errors for a correctly formated GraphQL response. For security, errors thrown outside resolvers without an `expose` property and `true` value are masked by a generic 500 error.

**Examples**

_A basic GraphQL API without using [graphqlApi](#graphqlapi)._

```javascript
import Koa from 'koa'
import bodyParser from 'koa-bodyparser'
import { errorHandler, execute } from 'graphql-api-koa'
import schema from './schema'

const app = new Koa()
  .use(errorHandler())
  .use(bodyParser())
  .use(execute({ schema }))
```

Returns **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** Koa middleware.

### bodyParser

- **See: [koa-bodyparser on npm](https://npm.im/koa-bodyparser).**

Creates Koa middleware to parse the request body as JSON to `ctx.request.body`. Included in [graphqlApi](#graphqlapi) after [errorHandler](#errorhandler) and before [execute](#execute).

### execute

Creates Koa middleware to execute GraphQL. Included in [graphqlApi](#graphqlapi) after [errorHandler](#errorhandler) and [bodyParser](#bodyparser).

**Parameters**

- `options` **[ExecuteOptions](#executeoptions)** Options.

Returns **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** Koa middleware.

### Types

The following types are for documentation only and are not exported.

#### ExecuteOptions

GraphQL [execute](#execute) Koa middleware options.

Type: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)

**Properties**

- `schema` **module:graphql.GraphQLSchema** GraphQL schema.
- `rootValue` **any?** Value passed to the first resolver.
- `contextValue` **any?** Execution context (usually an object) passed to resolvers.
- `fieldResolver` **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** Custom default field resolver.
- `override` **[MiddlewareOptionsOverride](#middlewareoptionsoverride)?** Override options per request.

#### MiddlewareOptionsOverride

Per-request Koa middleware options override.

Type: [Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)

**Parameters**

- `context` **module:koa.Context** Koa context.

**Examples**

_[execute](#execute) middleware options setting the schema once at startup and user context per-request._

```javascript
import schema from './schema'

const executeOptions = {
  schema,
  override: ctx => ({
    contextValue: {
      user: ctx.user
    }
  })
}
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Options.
